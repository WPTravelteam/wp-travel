!function(a){function b(b){var d=wp.template("my-template");a(".wp-travel-open-uploaded-images ul").append(d(b)),c(b)}function c(b){var c=[];a(".wp-travel-open-uploaded-images ul li").each(function(){c.push(a(this).data("attachmentid"))}),b.length>0&&a.each(b,function(a,b){c.push(parseInt(b.id))}),c=c.filter(Boolean);var d=c.filter(function(a,b,c){return b==c.indexOf(a)});console.log(d),a("#wp_travel_gallery_ids").val(d.join(","))}function d(b){a(".wp-travel-open-uploaded-images ul").children().removeClass("featured-image"),a("#wp_travel_thumbnail_id").val(b),a("#wp-travel-gallery-image-list-"+b).addClass("featured-image")}a(function(){if("undefined"!=typeof wp_travel_drag_drop_uploader.gallery_data){var e=wp_travel_drag_drop_uploader.gallery_data;b(e)}if("undefined"!=typeof wp_travel_drag_drop_uploader._thumbnail_id){var f=wp_travel_drag_drop_uploader._thumbnail_id;d(f)}if(a(".wp-travel-open-uploaded-images ul").sortable({update:function(){console.log(3434),c([])}}),a(document).on("click",".wp-travel-open-uploaded-images ul li img",function(){var b=a(this).parent();d(b.data("attachmentid"))}),a(document).on("click",".wp-travel-open-uploaded-images ul li span",function(){if(!confirm("sure to delete?"))return!1;var b=a(this).parent(),e=b.data("attachmentid"),f=a("#wp_travel_thumbnail_id").val();b.fadeOut("slow",function(){if(a(this).remove(),f==e){var b=a(".wp-travel-open-uploaded-images ul li:first").data("attachmentid");d(b)}c([])})}),a(".wp-travel-open-uploader").wpTravelUploader({media_options:{multiple:!0},onSelect:function(a){attachments=a.state().get("selection").toJSON(),console.log(attachments),b(attachments)}}),"undefined"!=typeof uploader){a("input#plupload-browse-button").val(wp_travel_drag_drop_uploader.labels.uploader_files_computer);var g=a(".wp-travel-upload-progress-bar"),h=a(".wp-travel-upload-progress-bar div.wp-travel-upload-progress-bar-inner"),i=a(".wp-travel-upload-progress-bar div.wp-travel-upload-progress-bar-status"),j=a("#wp-travel-upload-error"),k=0;uploader.bind("FilesAdded",function(b,c){a(j).html(""),k=c.length,a(".uploading .current",a(i)).text("1"),a(".uploading .total",a(i)).text(k),a(".uploading",a(i)).show(),a(".done",a(i)).hide(),a(g).fadeIn()}),uploader.bind("UploadProgress",function(b,c){a(".uploading .current",a(i)).text(k-b.total.queued+1),a(h).css({width:b.total.percent+"%"})}),uploader.bind("FileUploaded",function(c,d,e){var f=e.response.replace(/^<pre>(\d+)<\/pre>$/,"$1");f.match(/media-upload-error|error-div/)?a(j).html(e.response):a.post(wp_travel_drag_drop_uploader.ajax,{action:"envira_gallery_load_image",nonce:wp_travel_drag_drop_uploader.drag_drop_nonce,id:e.response},function(a){b([a])},"json")}),uploader.bind("UploadComplete",function(){a(".uploading",a(i)).hide(),a(".done",a(i)).show(),setTimeout(function(){a(g).fadeOut()},1e3)}),uploader.bind("Error",function(b,c){a(j).html('<div class="error fade"><p>'+c.file.name+": "+c.message+"</p></div>"),b.refresh()})}})}(jQuery);